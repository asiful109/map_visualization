<!DOCTYPE html>
<html>
  <head>
    <title>Rectangle Selection</title>
    
    <script>
      let map;
      let markers = [];
      let rectangle;

      function initMap() {
        // Initialize the map
        map = new google.maps.Map(document.getElementById('map'), {
          center: { lat: -34.397, lng: 150.644 },
          zoom: 8,
        });

        // Add markers
        const markerData = [
          { position: { lat: -34.397, lng: 150.644 } },
          { position: { lat: -34.497, lng: 150.544 } },
          { position: { lat: -34.597, lng: 150.444 } },
          // Add more markers as needed
        ];

        markerData.forEach((data) => {
          const marker = new google.maps.Marker({
            position: data.position,
            map: map,
          });
          markers.push(marker);
        });

        // Initialize the drawing manager
        const drawingManager = new google.maps.drawing.DrawingManager({
          drawingMode: google.maps.drawing.OverlayType.RECTANGLE,
          drawingControl: true,
          drawingControlOptions: {
            position: google.maps.ControlPosition.TOP_CENTER,
            drawingModes: ['rectangle'],
          },
          rectangleOptions: {
            editable: true,
            draggable: true,
          },
        });
        drawingManager.setMap(map);

        // Add listener for rectangle completion
        google.maps.event.addListener(drawingManager, 'rectanglecomplete', function (rect) {
          if (rectangle) {
            rectangle.setMap(null);
          }
          rectangle = rect;
          selectMarkersWithinRectangle(rectangle);
        });
      }

      function selectMarkersWithinRectangle(rectangle) {
        const bounds = rectangle.getBounds();
        markers.forEach((marker) => {
          if (bounds.contains(marker.getPosition())) {
            marker.setIcon('http://maps.google.com/mapfiles/ms/icons/green-dot.png');
          } else {
            marker.setIcon('http://maps.google.com/mapfiles/ms/icons/red-dot.png');
          }
        });
      }

      google.maps.event.addDomListener(window, 'load', initMap);
    </script>
    <style>
      #map {
        height: 100%;
      }
      html,
      body {
        height: 100%;
        margin: 0;
        padding: 0;
      }
    </style>
  </head>
  <body>
    <div id="map"></div>
  </body>
</html>
